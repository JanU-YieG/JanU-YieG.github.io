<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Docker - Borer&#39;s Blog</title><meta name="Description" content="Docker常用命令解释及其注意事项"><meta property="og:title" content="Docker" />
<meta property="og:description" content="Docker常用命令解释及其注意事项" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://janu-yieg.github.io/docker/" /><meta property="og:image" content="https://janu-yieg.github.io/borer.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-21T09:55:10+08:00" />
<meta property="article:modified_time" content="2021-07-21T09:55:10+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://janu-yieg.github.io/borer.png"/>

<meta name="twitter:title" content="Docker"/>
<meta name="twitter:description" content="Docker常用命令解释及其注意事项"/>
<meta name="application-name" content="Borer&#39;s blog">
<meta name="apple-mobile-web-app-title" content="Borer&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/borer.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://janu-yieg.github.io/docker/" /><link rel="prev" href="https://janu-yieg.github.io/markdown/" /><link rel="next" href="https://janu-yieg.github.io/cs-problems/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Docker",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/janu-yieg.github.io\/docker\/"
        },"image": ["https:\/\/janu-yieg.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "docker","wordcount":  3871 ,
        "url": "https:\/\/janu-yieg.github.io\/docker\/","datePublished": "2021-07-21T09:55:10+08:00","dateModified": "2021-07-21T09:55:10+08:00","license": "borer","publisher": {
            "@type": "Organization",
            "name": "borer","logo": "https:\/\/janu-yieg.github.io\/borer.png"},"author": {
                "@type": "Person",
                "name": "Borer"
            },"description": "Docker常用命令解释及其注意事项"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Borer&#39;s Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/borer.png"
        data-srcset="/borer.png, /borer.png 1.5x, /borer.png 2x"
        data-sizes="auto"
        alt="/borer.png"
        title="/borer.png" /><span id="id-1" class="typeit"></span><span class="header-title-post">  philosophy</span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/" title="All articles"><i class='fas fa-blog'></i> Posts </a><a class="menu-item" href="/tags/" title="All tags"><i class='fas fa-tag'></i> Tags </a><a class="menu-item" href="/categories/" title="All categories"><i class='fas fa-archive'></i> Categories </a><a class="menu-item" href="/links/" title="Links"><i class='fas fa-paperclip'></i> Links </a><a class="menu-item" href="/about/" title="about me"><i class='far fa-address-card'></i> about </a><a class="menu-item" href="https://github.com/JanU-YieG" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><a class="menu-item" href="https://www.rust-lang.org/" title="Rust" rel="noopener noreffer" target="_blank"><i class='fab fa-rust'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="linux" id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Borer&#39;s Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/borer.png"
        data-srcset="/borer.png, /borer.png 1.5x, /borer.png 2x"
        data-sizes="auto"
        alt="/borer.png"
        title="/borer.png" /><span id="id-2" class="typeit"></span><span class="header-title-post">  philosophy</span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="linux" id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="All articles"><i class='fas fa-blog'></i>Posts</a><a class="menu-item" href="/tags/" title="All tags"><i class='fas fa-tag'></i>Tags</a><a class="menu-item" href="/categories/" title="All categories"><i class='fas fa-archive'></i>Categories</a><a class="menu-item" href="/links/" title="Links"><i class='fas fa-paperclip'></i>Links</a><a class="menu-item" href="/about/" title="about me"><i class='far fa-address-card'></i>about</a><a class="menu-item" href="https://github.com/JanU-YieG" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a class="menu-item" href="https://www.rust-lang.org/" title="Rust" rel="noopener noreffer" target="_blank"><i class='fab fa-rust'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Docker</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/JanU-YieG" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Borer</a></span>&nbsp;<span class="post-category">included in <a href="/categories/docker/"><i class="far fa-folder fa-fw"></i>Docker</a>&nbsp;<a href="/categories/hunt/"><i class="far fa-folder fa-fw"></i>Hunt</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-07-21">2021-07-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;3871 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;8 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://cdn5.maocdn.cn/img/2021/08/05/docker-facebook.png"
        data-srcset="https://cdn5.maocdn.cn/img/2021/08/05/docker-facebook.png, https://cdn5.maocdn.cn/img/2021/08/05/docker-facebook.png 1.5x, https://cdn5.maocdn.cn/img/2021/08/05/docker-facebook.png 2x"
        data-sizes="auto"
        alt="https://cdn5.maocdn.cn/img/2021/08/05/docker-facebook.png"
        title="Docker常用命令解释及其注意事项" /></div><div class="details toc" id="toc-static"  kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#docker介绍">Docker介绍</a></li>
    <li><a href="#docker概念及命令">Docker概念及命令</a>
      <ul>
        <li><a href="#镜像">镜像</a>
          <ul>
            <li><a href="#镜像基本命令">镜像基本命令</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#docker-pull">docker pull</a></li>
                    <li><a href="#docker-image-ls">docker image ls</a></li>
                    <li><a href="#docker-image-rm">docker image rm</a></li>
                    <li><a href="#docker-commit">docker commit</a></li>
                    <li><a href="#docker-diff">docker diff</a></li>
                    <li><a href="#docker-import">docker import</a></li>
                    <li><a href="#docker-save--docker-load">docker save &amp; docker load</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#容器">容器</a>
          <ul>
            <li><a href="#容器基本命令">容器基本命令</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#docker-run">docker run</a></li>
                    <li><a href="#docker-container-start">docker container start</a></li>
                    <li><a href="#docker-container-stop">docker container stop</a></li>
                    <li><a href="#docker-container-restart">docker container restart</a></li>
                    <li><a href="#docker-container-rm">docker container rm</a></li>
                    <li><a href="#docker-container-ls--docker-ps">docker container ls || docker ps</a></li>
                    <li><a href="#docker-container-logs">docker container logs</a></li>
                    <li><a href="#docker-container-prune">docker container prune</a></li>
                    <li><a href="#docker-export">docker export</a></li>
                    <li><a href="#docker-inspect">docker inspect</a></li>
                    <li><a href="#docker-exec--docker-attach">docker exec &amp;&amp; docker attach</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#仓库">仓库</a>
          <ul>
            <li><a href="#仓库有关的基本命令">仓库有关的基本命令</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#docker-login">docker login</a></li>
                    <li><a href="#docker-logout">docker logout</a></li>
                    <li><a href="#docker-search">docker search</a></li>
                    <li><a href="#docker-pull-1">docker pull</a></li>
                    <li><a href="#docker-push">docker push</a></li>
                    <li><a href="#自动构建">自动构建</a></li>
                    <li><a href="#私有仓库">私有仓库</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#dockerfile">Dockerfile</a></li>
        <li><a href="#数据管理">数据管理</a>
          <ul>
            <li><a href="#数据卷">数据卷</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#docker-volume-create">docker volume create</a></li>
                    <li><a href="#docker-volume-ls">docker volume ls</a></li>
                    <li><a href="#docker-volume-inspect">docker volume inspect</a></li>
                    <li><a href="#docker-volume-rm">docker volume rm</a></li>
                    <li><a href="#docker-volume-prune">docker volume prune</a></li>
                    <li><a href="#启动一个挂在数据卷的容器">启动一个挂在数据卷的容器</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#挂载主机目录">挂载主机目录</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#挂载">挂载</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#网络">网络</a>
          <ul>
            <li><a href="#外部访问容器">外部访问容器</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#docker-port">docker port</a></li>
                    <li><a href="#例子">例子</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#容器互联">容器互联</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#docker-network">docker network</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#配置dns">配置DNS</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#配置全部容器的dns">配置全部容器的DNS</a></li>
                    <li><a href="#docker-run-1">docker run</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#docker-compose">docker-compose</a>
          <ul>
            <li><a href="#compose-相关链接">Compose 相关链接</a></li>
          </ul>
        </li>
        <li><a href="#dockerfile-1">Dockerfile</a>
          <ul>
            <li><a href="#dockerfile-相关链接">Dockerfile 相关链接</a></li>
          </ul>
        </li>
        <li><a href="#others">Others</a>
          <ul>
            <li><a href="#更换国内源">更换国内源</a></li>
            <li><a href="#docker-php-扩展安装">docker php 扩展安装</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="docker介绍">Docker介绍</h2>
<p>Docker takes away repetitive, mundane configuration tasks and is used throughout the development lifecycle for fast, easy and portable application development - desktop and cloud. Docker’s comprehensive end to end platform includes UIs, CLIs, APIs and security that are engineered to work together across the entire application delivery lifecycle.</p>
<p>Docker 使用 Google 公司推出的 Go 语言 进行开发实现，基于 Linux 内核的 cgroup，namespace，以及
OverlayFS 类的 Union FS 等技术，对进程进行封装隔离，属于
操作系统层面的虚拟化技术。由于隔离的进程独立于宿主和其它的隔离的进程，因此也称其为容器.</p>
<blockquote>
<p>命令都可以使用 &ndash;help查看帮助</p>
<p><a href="https://docs.docker.com/reference/" target="_blank" rel="noopener noreffer">Reference</a></p>
</blockquote>
<h2 id="docker概念及命令">Docker概念及命令</h2>
<h3 id="镜像">镜像</h3>
<p>对于 Linux 而言，内核启动后，会挂载 root 文件系统为其提供用户空间支持。而 Docker 镜像（Image），就相当于是一个 root 文件系统。 Docker 镜像
是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像 不包含 任何动态数据，其内容在构建之后也不会被改变。
分层存储</p>
<h4 id="镜像基本命令">镜像基本命令</h4>
<h6 id="docker-pull">docker pull</h6>
<ul>
<li>格式：docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]</li>
<li>说明：从Docker Registry拉取镜像</li>
</ul>
<h6 id="docker-image-ls">docker image ls</h6>
<ul>
<li>格式：docker image ls</li>
<li>说明：列出顶层镜像</li>
<li>注意：
<ul>
<li>docker image ls -a：列出包括中间层的所有镜像</li>
<li>docker system df：便捷查看镜像、容器、数据卷所占空间</li>
<li>docker image prune：删除虚悬镜像</li>
<li>docker image ls -q：只显示镜像ID</li>
<li>docker image ls -f &hellip;：根据条件过滤镜像</li>
</ul>
</li>
</ul>
<h6 id="docker-image-rm">docker image rm</h6>
<ul>
<li>格式：docker image rm [选项] &lt;镜像1&gt; [&lt;镜像2&gt; &hellip;]</li>
<li>说明：删除本地镜像</li>
<li>例子：docker image rm $(docker image ls -q -f before=mongo:3.2)</li>
</ul>
<h6 id="docker-commit"><del>docker commit</del></h6>
<ul>
<li>格式：docker commit [选项] &lt;容器ID或容器名&gt; [&lt;仓库名&gt;[:&lt;标签&gt;]]</li>
<li>说明：就是在原有镜像的基础上，再叠加上容器的存储层，并构成新的镜像</li>
<li>注意：不要使用这种方式构建镜像，应该使用Dockerfile</li>
</ul>
<h6 id="docker-diff">docker diff</h6>
<ul>
<li>格式：docker diff container</li>
<li>说明：查看容器文件系统中被修改的文件和目录</li>
</ul>
<h6 id="docker-import"><del>docker import</del></h6>
<ul>
<li>格式：docker import [选项] &lt;文件&gt;|<URL>|- [&lt;仓库名&gt;[:&lt;标签&gt;]]</li>
<li>说明：从rootfs压缩包导入镜像&ndash;导入一个容器快照到本地镜像库</li>
</ul>
<h6 id="docker-save--docker-load"><del>docker save &amp; docker load</del></h6>
<ul>
<li>说明：将镜像保存为一个文件</li>
<li>注意：现在使用Docker Registry迁移镜像不使用这种方式了</li>
</ul>
<h3 id="容器">容器</h3>
<p>容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行于属于自己的独立的 命名空间。因此容器可以拥有自己的 root 文件系统、自己的网络配置、自己的进程空间，甚至自己的用户 ID 空间。容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立于宿主的系统下操作一样。这种特性使得容器封装的应用比直接在宿主运行更加安全。
每一个容器运行时，是以镜像为基础层，在其上创建一个当前容器的存储层，我们可以称这个为容器运行时读写而准备的存储层为 容器存储层。
容器存储层的生存周期和容器一样，容器消亡时，容器存储层也随之消亡。因此，任何保存于容器存储层的信息都会随容器删除而丢失。</p>
<h4 id="容器基本命令">容器基本命令</h4>
<h6 id="docker-run">docker run</h6>
<ul>
<li>说明：新建并启动容器</li>
<li>流程：
<blockquote>
<ul>
<li>检查本地是否存在指定的镜像，不存在就从 registry 下载</li>
<li>利用镜像创建并启动一个容器</li>
<li>分配一个文件系统，并在只读的镜像层外面挂载一层可读写层</li>
<li>从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去</li>
<li>从地址池配置一个 ip 地址给容器</li>
<li>执行用户指定的应用程序</li>
<li>执行完毕后容器被终止</li>
</ul>
</blockquote>
</li>
<li>注意：
<ul>
<li>-d 守护进程后台运行容器</li>
<li>-i 交互式</li>
<li>-t Allocate a pseudo-TTY</li>
</ul>
</li>
</ul>
<h6 id="docker-container-start">docker container start</h6>
<ul>
<li>说明：启动已经终止的容器</li>
</ul>
<h6 id="docker-container-stop">docker container stop</h6>
<ul>
<li>说明：终止容器</li>
</ul>
<h6 id="docker-container-restart">docker container restart</h6>
<ul>
<li>说明：重新启动正在运行的容器</li>
</ul>
<h6 id="docker-container-rm">docker container rm</h6>
<ul>
<li>说明：删除容器</li>
</ul>
<h6 id="docker-container-ls--docker-ps">docker container ls || docker ps</h6>
<ul>
<li>说明：查看正在运行的容器</li>
<li>注意：docker container ls -a 查看所有状态的容器</li>
</ul>
<h6 id="docker-container-logs">docker container logs</h6>
<ul>
<li>格式：docker container logs [container ID or NAMES]</li>
<li>OR 格式：docker logs [container ID or NAMES]</li>
<li>说明：查看容器内日志</li>
</ul>
<h6 id="docker-container-prune">docker container prune</h6>
<ul>
<li>说明：清理所有处于终止状态的容器</li>
</ul>
<h6 id="docker-export">docker export</h6>
<ul>
<li>说明：导出容器快照到本地</li>
</ul>
<h6 id="docker-inspect">docker inspect</h6>
<ul>
<li>说明：查看容器信息</li>
</ul>
<h6 id="docker-exec--docker-attach">docker exec &amp;&amp; <del>docker attach</del></h6>
<ul>
<li>说明：进入容器</li>
<li>注意：
<ul>
<li>docker arrach 不推荐使用，因为从stdin中exit，会导致容器停止</li>
<li>docker exec 的-i -t参数有用</li>
</ul>
</li>
</ul>
<h3 id="仓库">仓库</h3>
<p>Docker Registry 公开服务：https://hub.docker.com/
私有 Docker Registry：使用docker registry搭建本地私有仓库</p>
<h4 id="仓库有关的基本命令">仓库有关的基本命令</h4>
<h6 id="docker-login">docker login</h6>
<ul>
<li>说明：登录某个Docker Hub</li>
</ul>
<h6 id="docker-logout">docker logout</h6>
<ul>
<li>说明：登出已经登录的Docker Hub</li>
</ul>
<h6 id="docker-search">docker search</h6>
<ul>
<li>说明：查询镜像</li>
</ul>
<h6 id="docker-pull-1">docker pull</h6>
<ul>
<li>说明：拉取镜像</li>
</ul>
<h6 id="docker-push">docker push</h6>
<ul>
<li>说明：推送镜像</li>
</ul>
<h6 id="自动构建">自动构建</h6>
<ul>
<li>说明：支持自动构建镜像</li>
</ul>
<h6 id="私有仓库">私有仓库</h6>
<ul>
<li>说明：支持使用docker-registry创建本地私有镜像仓库</li>
</ul>
<h3 id="dockerfile">Dockerfile</h3>
<p>Dockerfile 是一个文本文件，其内包含了一条条的 指令(Instruction)，每一条指令构建一层，因此每一条指令的内容，就是描述该层应当如何构建。</p>
<h3 id="数据管理">数据管理</h3>
<p>保证即使容器删除，数据也不会丢失。</p>
<h4 id="数据卷">数据卷</h4>
<p>数据卷 是一个可供一个或多个容器使用的特殊目录，它绕过 UFS.
数据卷 是被设计用来持久化数据的，它的生命周期独立于容器，Docker 不会在容器被删除后自动删除 数据卷，并且也不存在垃圾回收这样的机制来处理没有任何容器引用的 数据卷。如果需要在删除容器的同时移除数据卷。可以在删除容器的时候使用 <code>docker rm -v</code> 这个命令。
数据卷 的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定为挂载点的目录中的文件会复制到数据卷中（仅数据卷为空时会复制）。</p>
<h6 id="docker-volume-create">docker volume create</h6>
<ul>
<li>说明：创建一个数据卷</li>
</ul>
<h6 id="docker-volume-ls">docker volume ls</h6>
<ul>
<li>说明：查看所有数据卷</li>
</ul>
<h6 id="docker-volume-inspect">docker volume inspect</h6>
<ul>
<li>说明：查看指定数据卷信息</li>
</ul>
<h6 id="docker-volume-rm">docker volume rm</h6>
<ul>
<li>说明：删除数据卷</li>
</ul>
<h6 id="docker-volume-prune">docker volume prune</h6>
<ul>
<li>说明：删除所有无主的数据卷</li>
</ul>
<h6 id="启动一个挂在数据卷的容器">启动一个挂在数据卷的容器</h6>
<ul>
<li>例子：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ docker run -d -P \
    --name web \
    # -v my-vol:/usr/share/nginx/html \
    --mount source=my-vol,target=/usr/share/nginx/html \
    nginx:alpine
</code></pre></td></tr></table>
</div>
</div><h4 id="挂载主机目录">挂载主机目录</h4>
<p>创建容器的时候使用 &ndash;mount 标记可以指定挂载一个本地主机的目录到容器中去。
本地目录的路径必须是绝对路径，以前使用 -v 参数时如果本地目录不存在 Docker 会自动为你创建一个文件夹，现在使用 &ndash;mount 参数时如果本地目录不存在，Docker 会报错。</p>
<h6 id="挂载">挂载</h6>
<ul>
<li>例子：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">$ docker run -d -P \
    --name web \
    # -v /src/webapp:/usr/share/nginx/html \
    --mount type=bind,source=/src/webapp,target=/usr/share/nginx/html \
    nginx:alpine
</code></pre></td></tr></table>
</div>
</div><h3 id="网络">网络</h3>
<h4 id="外部访问容器">外部访问容器</h4>
<p>容器中可以运行一些网络应用，要让外部也可以访问这些应用，可以通过<code>-P</code>或<code>-p</code>参数来指定端口映射。</p>
<p>当使用<code>-P</code>标记时，Docker 会随机映射一个端口到内部容器开放的网络端口。</p>
<p><code>-p</code>则可以指定要映射的端口，并且，在一个指定端口上只可以绑定一个容器。支持的格式有 <code>ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort</code>。</p>
<h6 id="docker-port">docker port</h6>
<ul>
<li>格式：docker port CONTAINER [PRIVATE_PORT[/PROTO]]</li>
<li>说明：查看当前映射的端口的配置等</li>
<li>注意：
<ul>
<li>容器有自己的内部网络和 ip 地址（使用 docker inspect 查看，Docker 还可以有一个可变的网络配置。）</li>
<li><code>-p</code> 标记可以多次使用来绑定多个端口</li>
</ul>
</li>
</ul>
<h6 id="例子">例子</h6>
<ul>
<li>映射所有接口的地址
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">docker run -d -p 80:80 nginx:alpine
</code></pre></td></tr></table>
</div>
</div></li>
<li>映射到指定地址的指定端口
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">docker run -d -p 127.0.0.1:80:80 nginx:alpine
</code></pre></td></tr></table>
</div>
</div></li>
<li>映射到指定地址的任意端口
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">docker run -d -p 127.0.0.1::80 nginx:alpine
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>可以使用<code>udp</code>标记指定<code>udp</code>端口</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">docker run -d -p 127.0.0.1:80:80/udp nginx:alpine
</code></pre></td></tr></table>
</div>
</div></li>
<li>绑定多个端口
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">docker run -d \
    -p 80:80 \
    -p 443:443 \
    nginx:alpine
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="容器互联">容器互联</h4>
<p>强烈建议大家将容器加入自定义的 Docker 网络来连接多个容器，而不是使用 &ndash;link 参数。</p>
<h6 id="docker-network">docker network</h6>
<ul>
<li>格式：docker network COMMAND</li>
<li>说明：docker网络的相关操作命令</li>
<li>例子：
<ul>
<li>docker network create -d bridge my-net</li>
<li><code>-d</code> 参数指定 Docker 网络类型，有 <code>bridge overlay</code>。其中 overlay 网络类型用于 <code>Swarm mode</code></li>
<li>docker run -it &ndash;rm &ndash;name busybox1 &ndash;network my-net busybox sh</li>
<li>docker run -it &ndash;rm &ndash;name busybox2 &ndash;network my-net busybox sh</li>
</ul>
</li>
</ul>
<h4 id="配置dns">配置DNS</h4>
<p>如何自定义配置容器的主机名和 DNS 呢？秘诀就是 Docker 利用虚拟文件来挂载容器的 3 个相关配置文件。 在容器中使用<code>mount</code>命令可以看到挂载信息</p>
<h6 id="配置全部容器的dns">配置全部容器的DNS</h6>
<ul>
<li>说明：在<code>/etc/docker/daemon.json</code>文件中新增以下内容设置
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">{
  &#34;dns&#34; : [
    &#34;114.114.114.114&#34;,
    &#34;8.8.8.8&#34;
  ]
}
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h6 id="docker-run-1">docker run</h6>
<ul>
<li>说明：手动指定容器配置参数
<ul>
<li>-h HOSTNAME 或者 &ndash;hostname=HOSTNAME 设定容器的主机名，它会被写到容器内的 /etc/hostname 和 /etc/hosts。但它在容器外部看不到，既不会在 docker container ls 中显示，也不会在其他的容器的 /etc/hosts 看到。</li>
<li>&ndash;dns=IP_ADDRESS 添加 DNS 服务器到容器的 /etc/resolv.conf 中，让容器用这个服务器来解析所有不在 /etc/hosts 中的主机名。</li>
<li>&ndash;dns-search=DOMAIN 设定容器的搜索域，当设定搜索域为 .example.com 时，在搜索一个名为 host 的主机时，DNS 不仅搜索 host，还会搜索 host.example.com。</li>
</ul>
</li>
<li>注意：如果在容器启动时没有指定最后两个参数，Docker 会默认用主机上的 /etc/resolv.conf 来配置容器。</li>
</ul>
<h3 id="docker-compose">docker-compose</h3>
<h4 id="compose-相关链接">Compose 相关链接</h4>
<ul>
<li><a href="https://yeasy.gitbook.io/docker_practice/compose/commands" target="_blank" rel="noopener noreffer">Compose 命令说明</a></li>
<li><a href="https://yeasy.gitbook.io/docker_practice/compose/compose_file" target="_blank" rel="noopener noreffer">Compose 模板文件</a></li>
<li><a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreffer">Compose 官方文档</a></li>
<li><a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener noreffer">Compose file 官方文档</a></li>
</ul>
<h3 id="dockerfile-1">Dockerfile</h3>
<h4 id="dockerfile-相关链接">Dockerfile 相关链接</h4>
<ul>
<li><a href="https://yeasy.gitbook.io/docker_practice/image/dockerfile" target="_blank" rel="noopener noreffer">Dockerfile 指令详解</a></li>
<li><a href="https://github.com/docker-library/docs" target="_blank" rel="noopener noreffer">Docker 官方镜像 Dockerfile</a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener noreffer">Dockerfile 官方文档</a></li>
<li><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/" target="_blank" rel="noopener noreffer">Dockerfile 最佳实践文档</a></li>
</ul>
<h3 id="others">Others</h3>
<h4 id="更换国内源">更换国内源</h4>
<p><code>vim /etc/docker/daemon.json</code>
<code>{ &quot;registry-mirrors&quot;: [ &quot;https://hub-mirror.c.163.com&quot;, &quot;https://ustc-edu-cn.mirror.aliyuncs.com&quot;, &quot;https://ghcr.io&quot;, &quot;https://mirror.baidubce.com&quot; ] }</code></p>
<h4 id="docker-php-扩展安装">docker php 扩展安装</h4>
<ol>
<li>通过pecl方式安装</li>
<li>通过php容器中自带的特殊命令安装：
<blockquote>
<p>docker-php-source:在php容器中创建/usr/src/php目录，并在其中存放一些自带文件，php扩展源吗都在/usr/src/php/ext中</p>
<p>格式：docker-php-source extract | delete</p>
<p>说明：extract创建并初始化/usr/src/php目录，delete：删除/usr/src/php目录</p>
<p>docker-php-ext-enable:启动php扩展，pecl安装php扩展默认不启动扩展，如果想要使用扩展必须在php.ini中配置。该命令则自动给我们启动php扩展不需要修改php.ini配置文件.</p>
<p><code>ls 查看现有可以启动的扩展：/usr/local/lib/php/extensions/no-debug-non-zts-xxxxxx</code>
查看redis扩展是否启动：php -m | grep redis
启动redis扩展：docker-php-ext-enable redis</p>
<p>docker-php-ext-install:安装并启动php扩展
格式：docker-php-ext-install &ldquo;源吗包目录名&rdquo;
说明：&ldquo;源码包&quot;需要放在/usr/src/php/ext下
卸载：直接删除/usr/local/etc/php/conf.d对应的配置文件即可</p>
<p>docker-php-ext-configure:自定义安装的php扩展。</p>
</blockquote>
</li>
</ol></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-07-21</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://janu-yieg.github.io/docker/" data-title="Docker"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://janu-yieg.github.io/docker/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://janu-yieg.github.io/docker/" data-title="Docker" data-image="https://cdn5.maocdn.cn/img/2021/08/05/docker-facebook.png"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/docker/">docker</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/markdown/" class="prev" rel="prev" title="Markdown常用语法"><i class="fas fa-angle-left fa-fw"></i>Markdown常用语法</a>
            <a href="/cs-problems/" class="next" rel="next" title="Cs Problems">Cs Problems<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">less is more!</div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/JanU-YieG" target="_blank">borer</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/twemoji@13.0.0/dist/twemoji.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{"gitalk":{"admin":["JanU-YieG"],"clientID":"67a1cd85e91de1cc2ab9","clientSecret":"232b4d1a3d1e7568e843b6d12f9841ae6cbb227f","id":"2021-07-21T09:55:10+08:00","owner":"JanU-YieG","proxy":"https://shielded-brushlands-08810.herokuapp.com/https://github.com/login/oauth/access_token","repo":"JanU-YieG.github.io","title":"Docker"}},"data":{"id-1":"Borer's","id-2":"Borer's"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"},"twemoji":true,"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
